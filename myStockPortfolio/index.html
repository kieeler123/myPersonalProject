<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ“Š ë°°ë‹¹ ì„±ì¥ í¬íŠ¸ ëŒ€ì‹œë³´ë“œ</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #f2f2f2;
      }
      input,
      select {
        margin-right: 10px;
        padding: 5px;
      }
      a {
        color: aqua;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ“Š ë°°ë‹¹ ì„±ì¥ í¬íŠ¸ ëŒ€ì‹œë³´ë“œ</h1>

    <div>
      <input type="text" id="search" placeholder="ì¢…ëª© ê²€ìƒ‰ (ì˜ˆ: AAPL, LOW)" />
      <select id="countryFilter">
        <option value="">ì „ì²´ êµ­ê°€</option>
      </select>
      <select id="sectorFilter">
        <option value="">ì „ì²´ ì„¹í„°</option>
      </select>
    </div>

    <table>
      <thead>
        <tr>
          <th>êµ­ê°€</th>
          <th>ì¢…ëª©</th>
          <th>ì„¹í„°</th>
          <th>ì§€ê¸‰ ì£¼ì°¨</th>
          <th>ë°°ë‹¹ ì„±ì¥ë¥ </th>
          <th>ì£¼ê°€ ì„±ì¥ë¥ </th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <script>
      let allData = [];

      function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        data.forEach((item) => {
          const row = `<tr>
            <td>${item['êµ­ê°€']}</td>
            <td>
              <a href="chart.html?symbol=${item['í‹°ì»¤'] || ''}">${item['ì¢…ëª©']}</a>
            </td>
            <td>${item['ì„¹í„°']}</td>
            <td>${item['ì§€ê¸‰ ì£¼ì°¨ ë¶„ë¥˜']}</td>
            <td>${item['ë°°ë‹¹ ì„±ì¥ë¥  (5Y CAGR)']}%</td>
            <td>${item['ì£¼ê°€ ì„±ì¥ë¥  (5Y CAGR)']}%</td>
          </tr>`;
          tbody.insertAdjacentHTML('beforeend', row);
        });
      }

      function applyFilters() {
        const country = document.getElementById('countryFilter').value;
        const sector = document.getElementById('sectorFilter').value;
        const search = document.getElementById('search').value.toLowerCase();

        const filtered = allData.filter((item) => {
          return (
            (!country || item['êµ­ê°€'] === country) &&
            (!sector || item['ì„¹í„°'] === sector) &&
            (!search || item['ì¢…ëª©'].toLowerCase().includes(search))
          );
        });

        renderTable(filtered);
      }

      fetch('ë°°ë‹¹ì„±ì¥í¬íŠ¸_WEBìš©_CLEAN_v4_with_ticker.json')
        .then((res) => res.json())
        .then((data) => {
          allData = data;
          renderTable(allData);

          const countries = [...new Set(data.map((d) => d['êµ­ê°€']))];
          const sectors = [...new Set(data.map((d) => d['ì„¹í„°']))];
          const countrySelect = document.getElementById('countryFilter');
          const sectorSelect = document.getElementById('sectorFilter');

          countries.forEach((c) => {
            countrySelect.insertAdjacentHTML(
              'beforeend',
              `<option value="${c}">${c}</option>`
            );
          });
          sectors.forEach((s) => {
            sectorSelect.insertAdjacentHTML(
              'beforeend',
              `<option value="${s}">${s}</option>`
            );
          });
        });

      document.getElementById('search').addEventListener('input', applyFilters);
      document
        .getElementById('countryFilter')
        .addEventListener('change', applyFilters);
      document
        .getElementById('sectorFilter')
        .addEventListener('change', applyFilters);
    </script>
  </body>
</html>
